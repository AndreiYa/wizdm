
<h1>{{msgs.title}}</h1>
<p>{{msgs.description}}</p>

<mat-vertical-stepper linear>

  <mat-step [stepControl]="nameForm">

    <!-- NAME step: here we create a new project -->
    <form [formGroup]="nameForm" (ngSubmit)="draftProject()">

      <ng-template matStepLabel>{{msgs.appName.title}}</ng-template>
      
      <p class="mat-small">{{msgs.appName.description}}</p>

      <mat-form-field appearance="legacy" fxFill>

        <mat-label>{{msgs.appName.label}}</mat-label>
        
        <input matInput formControlName="name">
        
        <mat-hint>{{msgs.appName.hint}}</mat-hint>
        <mat-error *ngIf="nameForm.controls.name.errors" >
          {{ errorMessage(nameForm.controls.name.errors, msgs.appName.errors) }}
        </mat-error>
      </mat-form-field>

      <div class="bit-of-space">
        <button mat-button matStepperNext type="submit">{{msgs.buttons.next}}</button>
      </div>
    </form>
      
  </mat-step>

  <!-- QUESTION steps: here the list of questions dynamically build into the stepper  -->
  <mat-step *ngFor="let question of msgs.questions; let i=index" [stepControl]="stepForms[i]">
  
    <form [formGroup]="stepForms[i]" (ngSubmit)="updateApplication(i)">

      <ng-template matStepLabel>{{question.title}}</ng-template>
        
      <p class="mat-small">{{question.description}}</p>

      <ng-container *ngFor="let field of question.fields; let j=index">

        <ng-container [ngSwitch]="field.type">

          <!-- INPUT -->
          <mat-form-field *ngSwitchDefault appearance="legacy" fxFill>
            
            <mat-label>{{field.label}}</mat-label>
            <input matInput [formControlName]="field.name">
            
            <mat-hint *ngIf="field.hint">{{field.hint}}</mat-hint>
            <mat-error *ngIf="stepForms[i].controls[field.name].errors">
              {{ errorMessage(stepForms[i].controls[field.name].errors, field.errors) }}
            </mat-error>
          </mat-form-field>

          <!-- TEXTAREA -->
          <mat-form-field *ngSwitchCase="'textarea'" appearance="legacy" fxFill>
            
            <mat-label>{{field.label}}</mat-label>
            <textarea matInput [formControlName]="field.name" [rows]="field.rows || 5" >
            </textarea>

            <mat-hint *ngIf="field.hint">{{field.hint}}</mat-hint>
            <mat-error *ngIf="stepForms[i].controls[field.name].errors">
              {{ errorMessage(stepForms[i].controls[field.name].errors, field.errors) }}
            </mat-error>
          </mat-form-field>

          <div class="bit-of-space" *ngIf="j < question.fields.length - 1">
          </div>

        </ng-container>
      </ng-container>

      <div class="bit-of-space">
        <button mat-button matStepperPrevious type="button">{{msgs.buttons.back}}</button>
        <button mat-button matStepperNext type="submit">
          {{msgs.buttons.next}}
        </button>
      </div>
    </form>
  </mat-step>

  <mat-step>
    <ng-template matStepLabel>{{msgs.appSubmit.title}}</ng-template>
    
    <div fxLayout="row" fxLayoutAlign="center center" fxFill>
      <div class="disclaimer">
        <p>{{msgs.appSubmit.description}}</p>
        <p class="mat-small">
          <wm-disclaimer [source]="msgs.appSubmit.disclaimer"
                         (action)="popupTerms()"
                          actionClass="mat-link">
          </wm-disclaimer>
        </p>
        <div fxLayout="row" fxLayoutAlign="center center" fxFill>
          <mat-checkbox labelPosition="before" color="primary" #agree>
            <wm-disclaimer [source]="msgs.appSubmit.agree"
                           (action)="popupTerms()"
                            actionClass="mat-link">
            </wm-disclaimer>
          </mat-checkbox>
        </div>
      </div>
    </div>

    <mat-progress-bar *ngIf="progress" class="bit-of-space" mode="indeterminate"></mat-progress-bar>

    <div *ngIf="!progress" class="bit-of-space" fxLayout="row" fxLayoutAlign="center center">
      <button mat-button class="apply-btn" type="button" 
              [disabled]="!agree.checked" 
              (click)="submitProject()">
        {{ msgs.buttons.apply }}
      </button>
    </div>

  </mat-step>
      
</mat-vertical-stepper>