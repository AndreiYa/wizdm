
<h1 class="mat-title" [@vanish]="page">{{ pageData.title }}</h1>

<!-- INFO MESSAGE -->
<p *ngIf="!error && pageData.message" @inflate>
  {{pageData.message}}
</p>

<!-- ERROR MESSAGE -->
<p class="mat-error" *ngIf="error" @inflate>
  {{ errorMessage(error) }}
</p>

<form [formGroup]="form" fxLayout="column" 
                         fxLayoutAlign="space-around stretch" 
                         fxLayoutGap="10px" (ngSubmit)="signInOrRegister()">

  <!-- NAME -->
  <mat-form-field appearance="legacy" *ngIf="form.contains('name')" @inflate>
    <mat-label>{{ msgs.labels.fullname }}</mat-label>
    <input matInput formControlName="name">
    <mat-error *ngIf="form.controls.name.errors?.required">
      {{ msgs.errors.nameRequired }}
    </mat-error>
  </mat-form-field>

  <!-- EMAIL -->
  <mat-form-field appearance="legacy" *ngIf="form.contains('email')" @inflate>
    <mat-label>{{ msgs.labels.email }}</mat-label>
    <input matInput formControlName="email">
    <mat-error *ngIf="form.controls.email.errors?.required">
      {{ msgs.errors.emailRequired }}
    </mat-error>
    <mat-error *ngIf="form.controls.email.errors?.email">
      {{ msgs.errors.emailInvalid }}
    </mat-error>
  </mat-form-field>

  <!-- PASSWORD -->
  <mat-form-field appearance="legacy" *ngIf="form.contains('password')" @inflate>
    <mat-label>{{ msgs.labels.password }}</mat-label>
    <input matInput [type]="hide ? 'password' : 'text'" formControlName="password">
    <wm-icon matSuffix 
            [icon]="hide ? 'visibility_off' : 'visibility'" 
            (click)="hide = !hide">
    </wm-icon>
    <mat-error *ngIf="form.controls.password.errors?.required">
      {{ msgs.errors.passwordRequired }}
    </mat-error>
    <mat-hint class="mat-link" align="end" 
             (click)="switchPage('reset')" *ngIf="page === 'sign-in'" 
             @inflate>{{ msgs.forgotPassword }}</mat-hint>
  </mat-form-field>

  <!-- NEW EMAIL -->
  <mat-form-field appearance="legacy" *ngIf="form.contains('newEmail')" @inflate>
    <mat-label>{{ msgs.labels.newEmail }}</mat-label>
    <input matInput formControlName="newEmail">
    <mat-error *ngIf="form.controls.email.errors?.required">
      {{ msgs.errors.emailRequired }}
    </mat-error>
    <mat-error *ngIf="form.controls.email.errors?.email">
      {{ msgs.errors.emailInvalid }}
    </mat-error>
  </mat-form-field>

  <!-- NEW PASSWORD -->
  <mat-form-field appearance="legacy" *ngIf="form.contains('newPassword')" @inflate>
    <mat-label>{{ msgs.labels.newPassword }}</mat-label>
    <input matInput formControlName="newPassword">
    <mat-error *ngIf="form.controls.password.errors?.required">
      {{ msgs.errors.passwordRequired }}
    </mat-error>
  </mat-form-field>

  <!-- ACTION BUTTON -->
  <button mat-stroked-button color="primary" type="submit" [disabled]="!form.valid" class="btn">
    {{ pageData.caption }}
  </button>

  <mat-progress-bar *ngIf="progress" mode="indeterminate" @inflate></mat-progress-bar>
</form>

<!-- REGISTER LINK -->
<p class="mat-small bit-of-space" *ngIf="page === 'sign-in'">
  {{ msgs.newUser }}&nbsp;<span class="mat-link" (click)="switchPage('register')">{{ msgs.register }}</span>
</p>

<!-- BACK TO SIGN-IN LINK -->
<p class="mat-small bit-of-space" *ngIf="page === 'register' || page === 'reset'">
  {{ msgs.registeredUser }}&nbsp;<span class="mat-link" (click)="switchPage('sign-in')">{{ msgs.signIn }}</span>
</p>

<!-- SIGN IN WITH OPTION LINKS -->
<div fxLayout="column" fxLayoutAlign="center center" *ngIf="page === 'sign-in'" @inflate>

  <p class="mat-small">{{ msgs.signInWith }}</p>

  <div fxLayout="row wrap" fxLayoutAlign="center center" fxLayoutGap="10px">

    <button mat-icon-button *ngFor="let p of msgs.providers" (click)="signInWith(p.name)">
      <wm-icon class="providers"
              [icon]="p.icon"
              [ngStyle]="{ color: p.color }">
      </wm-icon>
    </button>
  </div>
</div>
