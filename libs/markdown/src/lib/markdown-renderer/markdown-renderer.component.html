
<ng-content></ng-content>

<ng-container [ngSwitch]="display">

  <!-- Renders the document body by default -->
  <ng-container *ngSwitchDefault>
    <ng-container *ngTemplateOutlet="document; context: root"></ng-container>
  </ng-container>

  <!-- Renders the table of contents -->
  <ng-container *ngSwitchCase="'toc'">
    <ng-container *ngTemplateOutlet="tableOfContent; context: root"></ng-container>
  </ng-container>

  <!-- Renders the footnotes -->
  <ng-container *ngSwitchCase="'footnotes'">
    <ng-container *ngTemplateOutlet="footnotes; context: root"></ng-container>
  </ng-container>

</ng-container>

<!-- Document body full features template -->
<ng-template let-children="children" #document>

  <ng-container *ngFor="let child of children">

    <ng-container [ngSwitch]="child.type">

      <!-- Headings -->
      <ng-container *ngSwitchCase="'heading'">
        <ng-container [ngSwitch]="child.depth">
          <h1 *ngSwitchCase="1" [attr.data-line]="position(child)" [id]="toc(child)">
            <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
          </h1>
          <h2 *ngSwitchCase="2" [attr.data-line]="position(child)" [id]="toc(child)">
            <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
          </h2>
          <h3 *ngSwitchCase="3" [attr.data-line]="position(child)" [id]="toc(child)">
            <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
          </h3>
          <h4 *ngSwitchCase="4" [attr.data-line]="position(child)" [id]="toc(child)">
            <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
          </h4>
          <h5 *ngSwitchCase="5" [attr.data-line]="position(child)" [id]="toc(child)">
            <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
          </h5>
          <h6 *ngSwitchCase="6" [attr.data-line]="position(child)" [id]="toc(child)">
            <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
          </h6>
        </ng-container>
      </ng-container>

      <!-- Paragraph -->
      <p *ngSwitchCase="'paragraph'" [attr.data-line]="position(child)">
        <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
      </p>

      <!-- Blockquote -->
      <blockquote *ngSwitchCase="'blockquote'" [attr.data-line]="position(child)">
        <ng-container *ngTemplateOutlet="document; context: child"></ng-container>
      </blockquote>
      
      <!-- List -->
      <ng-container *ngSwitchCase="'list'">
        <ol *ngIf="child.ordered" [start]="child.start" [attr.data-line]="position(child)">
          <li *ngFor="let item of child.children">
            <!--{{assertNode(item, 'listItem')}}-->
            <ng-container *ngTemplateOutlet="decoratedText; context: item"></ng-container>
          </li>
        </ol>
        <ul *ngIf="!child.ordered" [attr.data-line]="position(child)">
          <li *ngFor="let item of child.children">
            <!--{{assertNode(item, 'listItem')}}-->
            <ng-container *ngTemplateOutlet="decoratedText; context: item"></ng-container>
          </li>
        </ul>
      </ng-container>

      <!-- Table -->
      <table *ngSwitchCase="'table'" [attr.data-line]="position(child)">
        <tbody>
          <tr *ngFor="let row of child.children">
            <!--{{assertNode(row, 'tableRow')}}-->
            <td *ngFor="let cell of row?.children; let i = index" [attr.align]="child.align[i]">
              <!--{{assertNode(cell, 'tableCell')}}-->
              <ng-container *ngTemplateOutlet="decoratedText; context: cell"></ng-container>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Thematic Break -->
      <hr *ngSwitchCase="'thematicBreak'" [attr.data-line]="position(child)" />

      <!-- Line Break -->
      <br *ngSwitchCase="'break'" />

      <!-- Code -->
      <pre *ngSwitchCase="'code'" [attr.data-line]="position(child)">
        <code [wm-highlight]="child.value" [language]="child.lang"></code>
      </pre>
 
      <!-- Left aligned block - Align plugin -->
      <span *ngSwitchCase="'leftAligned'" [attr.align]="'left'">
        <ng-container *ngTemplateOutlet="document; context: child"></ng-container>
      </span>

      <!-- Center aligned block - Align plugin -->
      <span *ngSwitchCase="'centerAligned'" [attr.align]="'center'">
        <ng-container *ngTemplateOutlet="document; context: child"></ng-container>
      </span>

      <!-- Right aligned block - Align plugin -->
      <span *ngSwitchCase="'rightAligned'" [attr.align]="'right'">
        <ng-container *ngTemplateOutlet="document; context: child"></ng-container>
      </span>

    </ng-container>

  </ng-container>

</ng-template>

<!-- Decorated text template: Renders the text with decorations only (images are included) -->
<ng-template let-children="children" #decoratedText>

  <ng-container *ngFor="let child of children">

    <ng-container [ngSwitch]="child.type">
      
      <!-- Emphasis -->
      <em *ngSwitchCase="'emphasis'">
          <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
      </em>
      
      <!-- Strong -->
      <strong *ngSwitchCase="'strong'">
        <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
      </strong>
      
      <!-- Delete -->
      <del *ngSwitchCase="'delete'">
        <ng-container *ngTemplateOutlet="decoratedText; context: child">
        </ng-container>
      </del>
      
      <!-- Link -->
      <a *ngSwitchCase="'link'" [href]="child.url" (click)="navigateUrl($event, child.url)">
        <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
      </a>

      <!-- Link Reference -->
      <a *ngSwitchCase="'linkReference'" [href]="definition(child.identifier)" (click)="navigateDef($event, child.identifier)">
        <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
      </a>

      <!-- Inlide Code -->
      <code *ngSwitchCase="'inlineCode'">{{child.value}}</code>
      
      <!-- Sub-script Super-script plugin -->
      <sub *ngSwitchCase="'sub'">
        <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
      </sub>
      
      <!-- Super-script Super-script plugin -->
      <sup *ngSwitchCase="'sup'">
        <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
      </sup>
      
      <!-- Footnote Reference -->
      <sup *ngSwitchCase="'footnoteReference'">[{{footnote(child.identifier)}}]</sup>
      
      <!-- Plain text -->
      <ng-container *ngSwitchCase="'text'">{{child.value}}</ng-container>

      <!-- Image -->
      <img *ngSwitchCase="'image'" [src]="child.url" [title]="child.title" [alt]="child.alt" [attr.data-line]="position(child)" />

      <!-- Image Reference -->
      <img *ngSwitchCase="'imageReference'" [src]="definition(child.identifier)" [title]="child.title" [alt]="child.alt" [attr.data-line]="position(child)" />
      
      <!-- Recurs to next level -->
      <ng-container *ngSwitchDefault>
        <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
      </ng-container>

    </ng-container>

  </ng-container>

</ng-template>

<!-- Plain text template: Renders all the content in plain text only -->
<ng-template let-children="children" #plainText>

  <ng-container *ngFor="let child of children">

    <ng-container *ngIf="child.value; else goDeeper">{{child.value}}</ng-container>

    <ng-template #goDeeper>
      <ng-container *ngTemplateOutlet="plainText; context: child"></ng-container>
    </ng-template>

  </ng-container>

</ng-template>

<!-- Table of contents template -->
<ng-template let-children="children" #tableOfContent>

  <span *ngFor="let child of filterNodes(children, 'heading')"
        (click)="navigateToc($event, toc(child))"
        [attr.toc]="child.depth">
    <ng-container *ngTemplateOutlet="plainText; context: child"></ng-container>
  </span>

</ng-template>

<!-- Footnotes template -->
<ng-template let-children="children" #footnotes>

  <span *ngFor="let child of filterNodes(children, 'footnoteDefinition')"
        [attr.footnote]="footnote(child.identifier)"
        [id]="'fn'+footnote(child.identifier)">
    {{footnote(child.identifier)}} -&nbsp;
    <ng-container *ngTemplateOutlet="decoratedText; context: child"></ng-container>
  </span>

</ng-template>
